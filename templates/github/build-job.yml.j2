{% for platform in platforms %}
  build-{{ image.name }}-{{ platform }}:
    runs-on: ubuntu-latest
{%- if image.dependencies %}
    needs:
{%- for dep in image.dependencies %}
      - manifest-{{ dep }}
{%- endfor %}
{%- endif %}
    steps:
      - uses: actions/checkout@v4
      - uses: astral-sh/setup-uv@v4
      - run: uv sync
      - run: uv run image-manager build {{ image.name }} --platform {{ platform }} --snapshot-id "$SNAPSHOT_ID"
      - run: uv run image-manager sbom {{ image.name }} --platform {{ platform }} --snapshot-id "$SNAPSHOT_ID"
{% endfor %}
