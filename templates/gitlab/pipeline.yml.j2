# Auto-generated by image-manager generate-ci
# Generated: {{ generated_at }}
# Do not edit - regenerate with: uv run image-manager generate-ci

stages:
{%- for stage in stages %}
  - {{ stage }}
{%- endfor %}

variables:
  SNAPSHOT_ID: ${CI_MERGE_REQUEST_IID}

# === BASE TEMPLATES ===

.build:
  script:
    - uv run image-manager build ${IMAGE_NAME} --platform ${PLATFORM} --snapshot-id "$SNAPSHOT_ID"
    - uv run image-manager sbom ${IMAGE_NAME} --platform ${PLATFORM} --snapshot-id "$SNAPSHOT_ID"

.manifest:
  script:
    - uv run image-manager manifest ${IMAGE_NAME} --snapshot-id "$SNAPSHOT_ID"

.test:
  stage: test
  script:
    - uv run image-manager test ${IMAGE_NAME} --snapshot-id "$SNAPSHOT_ID"
{% for image in images %}

# === {{ image.name | upper }} ===
{% include 'build-job.yml.j2' -%}
{% include 'manifest-job.yml.j2' -%}
{% include 'test-job.yml.j2' -%}
{% endfor %}
