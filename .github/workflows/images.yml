# Auto-generated by image-manager generate-ci
# Generated: 2026-01-02T14:23:47.450135+00:00
# Do not edit - regenerate with: uv run image-manager generate-ci --provider github

name: Build Images

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

env:
  SNAPSHOT_ID: ${{ github.event.pull_request.number }}

jobs:

  # === BASE ===

  build-base-amd64:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: astral-sh/setup-uv@v4
      - run: uv sync
      - run: uv run image-manager build base --platform amd64 --snapshot-id "$SNAPSHOT_ID"
      - run: uv run image-manager sbom base --platform amd64 --snapshot-id "$SNAPSHOT_ID"

  build-base-arm64:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: astral-sh/setup-uv@v4
      - run: uv sync
      - run: uv run image-manager build base --platform arm64 --snapshot-id "$SNAPSHOT_ID"
      - run: uv run image-manager sbom base --platform arm64 --snapshot-id "$SNAPSHOT_ID"

  manifest-base:
    runs-on: ubuntu-latest
    needs:
      - build-base-amd64
      - build-base-arm64
    steps:
      - uses: actions/checkout@v4
      - uses: astral-sh/setup-uv@v4
      - run: uv sync
      - run: uv run image-manager manifest base --snapshot-id "$SNAPSHOT_ID"
  test-base:
    runs-on: ubuntu-latest
    needs:
      - manifest-base
    steps:
      - uses: actions/checkout@v4
      - uses: astral-sh/setup-uv@v4
      - run: uv sync
      - run: uv run image-manager test base --snapshot-id "$SNAPSHOT_ID"


  # === DOTNET ===

  build-dotnet-amd64:
    runs-on: ubuntu-latest
    needs:
      - manifest-base
    steps:
      - uses: actions/checkout@v4
      - uses: astral-sh/setup-uv@v4
      - run: uv sync
      - run: uv run image-manager build dotnet --platform amd64 --snapshot-id "$SNAPSHOT_ID"
      - run: uv run image-manager sbom dotnet --platform amd64 --snapshot-id "$SNAPSHOT_ID"

  build-dotnet-arm64:
    runs-on: ubuntu-latest
    needs:
      - manifest-base
    steps:
      - uses: actions/checkout@v4
      - uses: astral-sh/setup-uv@v4
      - run: uv sync
      - run: uv run image-manager build dotnet --platform arm64 --snapshot-id "$SNAPSHOT_ID"
      - run: uv run image-manager sbom dotnet --platform arm64 --snapshot-id "$SNAPSHOT_ID"

  manifest-dotnet:
    runs-on: ubuntu-latest
    needs:
      - build-dotnet-amd64
      - build-dotnet-arm64
    steps:
      - uses: actions/checkout@v4
      - uses: astral-sh/setup-uv@v4
      - run: uv sync
      - run: uv run image-manager manifest dotnet --snapshot-id "$SNAPSHOT_ID"
  test-dotnet:
    runs-on: ubuntu-latest
    needs:
      - manifest-dotnet
    steps:
      - uses: actions/checkout@v4
      - uses: astral-sh/setup-uv@v4
      - run: uv sync
      - run: uv run image-manager test dotnet --snapshot-id "$SNAPSHOT_ID"


  # === PYTHON ===

  build-python-amd64:
    runs-on: ubuntu-latest
    needs:
      - manifest-base
    steps:
      - uses: actions/checkout@v4
      - uses: astral-sh/setup-uv@v4
      - run: uv sync
      - run: uv run image-manager build python --platform amd64 --snapshot-id "$SNAPSHOT_ID"
      - run: uv run image-manager sbom python --platform amd64 --snapshot-id "$SNAPSHOT_ID"

  build-python-arm64:
    runs-on: ubuntu-latest
    needs:
      - manifest-base
    steps:
      - uses: actions/checkout@v4
      - uses: astral-sh/setup-uv@v4
      - run: uv sync
      - run: uv run image-manager build python --platform arm64 --snapshot-id "$SNAPSHOT_ID"
      - run: uv run image-manager sbom python --platform arm64 --snapshot-id "$SNAPSHOT_ID"

  manifest-python:
    runs-on: ubuntu-latest
    needs:
      - build-python-amd64
      - build-python-arm64
    steps:
      - uses: actions/checkout@v4
      - uses: astral-sh/setup-uv@v4
      - run: uv sync
      - run: uv run image-manager manifest python --snapshot-id "$SNAPSHOT_ID"
  test-python:
    runs-on: ubuntu-latest
    needs:
      - manifest-python
    steps:
      - uses: actions/checkout@v4
      - uses: astral-sh/setup-uv@v4
      - run: uv sync
      - run: uv run image-manager test python --snapshot-id "$SNAPSHOT_ID"


